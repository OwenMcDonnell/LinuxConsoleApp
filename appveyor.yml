version: 1.0.{build}

image: Visual Studio 2017

environment:
  test_var: test
    
install:
  #- cd ..
  #- ls
  #- cd $APPVEYOR_BUILD_FOLDER
  #- $APPVEYOR_BUILD_FOLDER
  - nuget restore
  #- chcp 65001
  #- echo %APPVEYOR_REPO_COMMIT_MESSAGE%
  - ps: |
      write-host "start restart"
      [Environment]::SetEnvironmentVariable("PATH", $env:PATH + ";C:\Solidity", "Machine")
  - ps: Restart-Computer
  - ps: Start-Sleep -s 10
  - ps: |
      [environment]::GetEnvironmentVariable("PATH","Machine").split(";")
  - build.cmd
  
  
#artifacts:
#- path: LinuxConsoleApp\bin\**\*

build:
  project: LinuxConsoleApp.sln
  #publish_wap: true
  
before_deploy:
  - ps: |
          $artifactPaths = ''
          foreach ($artifactName in $artifacts.keys) { 
            $artifacts[$artifactName]
            7z a package.zip $artifacts[$artifactName].path
            $artifactPaths += $artifacts[$artifactName].path
          }
          write-host $artifactPaths
          
  - appveyor PushArtifact package.zip 
          
deploy_script: 
  - ps: | 
          $artifacts.count
          foreach ($artifactName in $artifacts.keys) {             
            $artifacts[$artifactName]
          }
